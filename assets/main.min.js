function Modal(e,t){let o={open:function(){if(o.isOpen)return;o.isOpen=!0,Modal._modalsOpen++,o._nthModalOpened=Modal._modalsOpen;let e=1e3+2*Modal._modalsOpen;if(o.$overlay.css({zIndex:e}),o.$el.css({zIndex:e+1}),o.options.preventScrolling&&$("body").addClass("no-scroll"),o.$overlay.show().css({opacity:o.options.opacity}),o.el.insertAdjacentElement("afterend",o.$overlay[0]),o.$el.addClass("open"),o.options.dismissible){var t=$(document);t.on("keydown",function(e){27===e.keyCode&&o.options.dismissible&&o.close()}),t.on("focus",function(e){o.el.contains(e.target)||o._nthModalOpened!==Modal._modalsOpen||o.el.focus()})}o.el.focus()},close:function(){if(o.isOpen){if(o.isOpen=!1,Modal._modalsOpen--,o._nthModalOpened=0,o.$overlay.css({opacity:0}),o.$el.removeClass("open"),$("body").removeClass("no-scroll"),o.options.dismissible){var e=$(document);e.off("keydown",o._handleKeydownBound),e.off("focus",o._handleFocusBound,!0)}setTimeout(function(){o.$overlay.remove(),o.options.onCloseEnd&&o.options.onCloseEnd()},250)}}};return o.el=e.is()?e[0]:e,o.$el=$(e),o.options=$.fn.extend({opacity:.5,onCloseEnd:null,preventScrolling:!0,dismissible:!0},t),o.isOpen=!1,o.$overlay=$(`<div ${0==o.options.opacity?"":'class="overlay"'}></div>`),o._nthModalOpened=0,Modal._count++,o.$overlay.on("click",function(){o.options.dismissible&&o.close()}),o.$el.on("click",function(e){$(e.target).closest(".modal-close").is()&&o.close()}),o}function ga(e,t={}){t={...t,t:e,cd1:"serviceWorker"in navigator?navigator.serviceWorker.controller?"controlled":"supported":"unsupported",cd2:!0===navigator.standalone||matchMedia("(display-mode: standalone)").matches?1:0,sr:`${innerWidth}x${innerHeight}`,ul:navigator.language.toLowerCase(),dl:location.href,dt:document.title};let o="";for(let e in t)o+=`${e}=${encodeURIComponent(t[e])}&`;ajax(`../collect?${o}`,()=>{})}Modal._modalsOpen=0,function(e){var t,o,n,i,a=navigator.userAgent,l="createTouch"in document,s={},c=!1,r=!1,d=!1,p=!1,f=!1,u={},h=!1,m=!1;function g(e){return e.split("#")[0]}function v(e){let t=$(e).closest("a");return t.is()?t:$(e)}function y(e){let o=e[0];var n=location.protocol+"//"+location.host;return!(!e.is("a")||o.target||e.hasAttr("download")||0!=o.href.indexOf(n+"/")||g(o.href)==t||$(e).closest("[data-no-instant]").is())}function b(e,o,n){document.documentElement.replaceChild(o,document.body),t=g(n),url=n.split("#"),history.pushState(null,null,url[0]),document.title=e+String.fromCharCode(160),location.hash=url[1]?`#${url[1]}`:"",w(),O.done()}function k(e){if(i<+new Date-500){var t=v(e.target);t.is()&&y(t)&&x(t[0].href)}}function C(e){var t=v(e.target);t.is()&&y(t)&&(e.which>1||e.metaKey||e.ctrlKey||(e.preventDefault(),M(t[0].href)))}function w(){$("body").on("mousedown",k).on("click",C),D()}function x(e){n&&(clearTimeout(n),n=!1),e||(e=o),h||e==r||m||(h=!0,m=!1,r=e,f=!1,p=!1,u={start:Date.now()},e=addParam(e,"just_html"),(c=ajax(e,function(e){u.ready=Date.now()-u.start;var t=document.implementation.createHTMLDocument("");t.documentElement.innerHTML=e.replace(/<noscript[\s\S]+<\/noscript>/gi,""),d=t.title,f=t.body;var o=g(r);s[o]={body:f,title:d,scrollY:o in s?s[o].scrollY:0},m&&(m=!1,M(r))},c)).onerror=function(){m=!1,O.done()})}function M(e){if("display"in u||(u.display=Date.now()-u.start),n||!h){if(n&&r&&r!=e)return void(location.href=e);x(e),O.start(0,!0),m=!0}else m?location.href=e:p?location.href=r:f?(s[t].scrollY=pageYOffset,h=!1,m=!1,b(d,f,r)):(O.start(0,!0),m=!0)}var O=function(){var t,o,n,i;function a(e,o){n=e,t.css({opacity:1}),c(),o&&requestAnimationFrame(function(){n=10,c()}),clearTimeout(i),i=setTimeout(s,500)}function s(){n<98&&(n+=1+2*Math.random(),i=setTimeout(s,500)),c()}function c(){o.css({transform:"translate("+n+"%)"}),!$("#ic").is()&&document.body&&$("body").append(t)}function r(){t.css({left:pageXOffset+"px",width:innerWidth+"px",top:pageYOffset+"px"});var o="orientation"in e&&90==Math.abs(orientation),n=innerWidth/screen[o?"height":"width"]*2;t.css("transform",`scaleY(${n})`)}return{init:function(){t=$('<div id="ic"></div>'),$("body").append(t),o=$('<div id="ic-bar" class="ic-bar"></div>'),t.append(o);var n=prefix+"transition",i=$("<style/>");i.html("#ic{position:"+(l?"absolute":"fixed")+";top:0;left:0;width:100%;pointer-events:none;z-index:9999;"+n+":all .25s .1s}.ic-bar{background:red;width:100%;margin-left:-100%;height:2px;"+n+":all .25s}"),$("head").append(i),l&&(r(),$(e).on("resize",r).on("scroll",r))},start:a,done:function e(){if($("#ic").is())return clearTimeout(i),n=100,c(),void t.css({opacity:0});a(100==n?0:n),requestAnimationFrame(e)}}}(),T="pushState"in history&&(!a.match("Android")||a.match("Chrome/"));function j(){if(/\/orarend/.test(location.href)){$(".collection-item").css("height","unset");for(let e=$("ul"),t=0;e.is();e=$("ul.collection li:nth-child("+ ++t+")")){if(0==t)continue;let o=0;e.each(e=>{o=Math.max($(e).height(),o)}),e.css("height",o+"px")}$("#tt")[0].scrollTo(innerWidth*$("b.active").index(),0)}}const Y=e=>Math.round(100*e)/100;function _(e){let t=[],o=0;e.find(".jegy").each(e=>{let n=(e=$(e)).is("b")?1:e.attr("tooltip").indexOf("100%")<0?.25:.5,i=e.html();i.indexOf("/")<0?t.push(n*i):t.push(...i.split("/").map(e=>e*(n/2))),o+=n});let n=Y(t.reduce((e,t)=>Number(e)+Number(t))/o),i=e.find("nd"),a=Y(n-i.eq(-2).html());i.eq(-1).html(a).removeClass("red gr").addClass(a<0?"red":"gr"),i.eq(-3).html(n);let l=$(`[value="${i.eq(0).attr("data-v")}"]`);l.html([l.html().split(" - ").shift(),n].join(" - "))}function S(e,t,o,n,i){e.find("span").html("-"),$(o).each(function(o){let n=t.attr(`data-${o}`);n&&e.find(`[data-${o}]`).html(n)});for(let t in n)e.find(`[data-${t}]`).html(n[t]);i.open()}function D(){const t=$("#menu"),o=$(location.hash),n=location.href;o.is()&&(intoView(o[0]),$(o).find(".collapsible-body").addClass("open")),e.scrolling=!1;let a=$("body"),l=!1,s=!1,c={x:0,y:0},r={x:0,y:0},d=0,p=!1,f=!1,u=!1,h=t.next();function m(){u&&f||(scrolling=!0)}function g(e){t.css({transform:`translateX(${e})`})}function b(){h.show().css({opacity:""}),a.addClass("no-scroll"),g(0),t.addClass("open"),u=!0}function C(){h.hide(),a.removeClass("no-scroll"),g("-110%"),t.removeClass("open"),u=!1}function w(){s||($("#rle").css({top:""}),$("body").removeClass("spin"))}if($(e).on("resize",j).on("scroll",m).on("mousemove","[tooltip]",function(){$(this).toggleClass("bot",$(this).offset().top-scrollY-getComputedStyle(this,":after").getPropertyValue("height").replace("px","")-76<=0)}).on("dblclick",".milenne",function(){let e=$(this),t=e.closest("nr");e.remove(),_(t)}).on("error",function(e){ga("exception",{exd:e.error&&e.error.stack||`${e.message}; ${e.lineno}: ${e.colno} `})}).on("click","nr nd:first-child",function(e){$(this).closest("nr").toggleClass("open")}),$(".overlay").on("click",C),$("#mo").on("click",()=>{b()}),a.on("touchstart",function(e){if(1==e.touches.length){p=!1,f=!1,c.x=e.touches[0].pageX,c.y=e.touches[0].pageY,i=+new Date;var t=v(e.target);t.is()&&y(t)&&(t.off("mousedown",k),x(t[0].href))}}).on("touchmove",function(e){if(h.hide(),(f||u)&&h.show(),!scrolling&&void 0!==e.touches&&!Modal._modalsOpen){var t=e.touches[0].clientX-c.x,o=d=t;if((Math.abs(o)<307||c.x<50)&&Math.abs(t)>20&&(f=!0,!u&&t>0||u&&t<0)){t<=0&&(o=t+307,f=!1);let e=o-307;h.css({opacity:(280+e)/280*.2}),g(Math.min(e,0)+"px"),p=!0}if(l=0===document.scrollingElement.scrollTop&&!(u||f),a.toggleClass("no-scroll",l),l&&!s){const t=e.touches[0].pageY-c.y;$("#rle").css({top:Math.min(t,120)+"px"})}else w()}}).on("touchcancel",function(){p=!1,f=!1,scrolling=!1}).on("touchend",function(e){if(p&&(f&&Math.abs(d)>70?b():C()),p=!1,r.x=e.changedTouches[0].pageX,r.y=e.changedTouches[0].pageY,l){var t=Math.abs(c.y-r.y),o=Math.abs(c.x-r.x);!s&&c.y<r.y&&(o<=100&&t>=90||o/t<=.3&&t>=60)?(w(),$("body").addClass("spin"),s=!0,M(addParam(location.href,"fr"))):w(),l=!1}scrolling=!1}),/\/orarend/.test(n)){j();let e=$(`[data-day="${(new Date).toISOString().split("T")[0]}"]`);e.is()&&(e.addClass("activeDay"),$("#tt")[0].scrollTo(e.index()*innerWidth,0));var O=Modal(D=$("#modal"));$(".lesson").on("click",function(){let e=$(this),t=e.find("b");S(D,e,["lecke","time","theme"],{nth:e.parent().attr("data-nth"),tr:t.html(),teacher:e.find("i").html(),room:e.find(".secondary-content").html()},O),D.find(".modal-content>span").html(t.is(".em")?"Elmarad!":"")}),$(".btns b").on("click",function(){let e=$(this);$("#tt")[0].scrollTo(innerWidth*e.index(),0),e.siblings().removeClass("active")});let t=null;$("#tt").on("scroll",()=>{clearTimeout(t),t=setTimeout(function(){$(".btns b").removeClass("active").eq(Math.round($("#tt")[0].scrollLeft/innerWidth)).addClass("active")},250),m()}),$("#printBtn").on("click",function(){print()}),o.is(".lesson")&&o[0].click()}if(/\/faliujsag/.test(n)&&$("#fj li").on("click",function(e){$(e.target).is("a")||$(this).find(".secondary-content")[0].click()}),/\/lecke/.test(n)){if(!/Mobi|Android/i.test(navigator.userAgent))if("DatePicker"in e)new DatePicker;else{var T=document.createElement("script");T.type="text/javascript",T.src="assets/picker.js",T.onload=function(){new DatePicker},$("body").append(T)}$("[name=t]").on("change",function(){"date"==this.value?($("#hi").show(),$("#date").attr("required",!0)):($("#hi").hide(),$("#date")[0].removeAttribute("required"))});O=Modal(D=$("#modal"));$(".collection-item").on("click",function(){let e=$(this),t=D.find("a").hide();e.hasAttr("data-del")&&t.show().attr("href","./lecke/torles?did="+e.attr("data-del")),O.open(),S(D,e,["lecke","sender","cdate"],{deadline:e.find("a").html(),tr:e.html().split("<")[0]},O)});var Y=Modal($("#addModal"));$(".fab").on("click",function(){Y.open()}),$("form").on("submit",function(){let e=$("#txt")[0],t=e.innerText.trim();return t?($("#hw").val(t),!0):(e.focus(),!1)})}if($(".collapsible .collapsible-header").on("click",function(){$(this).next().toggleClass("open")}),/\/hianyzasok/.test(n)){var D;O=Modal(D=$("#modal"));$("li p").on("click",function(){let e=$(this),t=e.parent().prev();S(D,e,["ct","jst","t","s"],{d:t.find("span").html(),ty:t.attr("data-ty")},O),$("#link").attr("href",`orarend?week=-${e.attr("data-l")}`)})}if(/\/jegyek/.test(n)){o.closest("nr").addClass("open");let e=Modal($("#addModal"));$(".fab").on("click",e.open);let t=$("#tr");$("#tort").on("change",function(){$(".j").hide().eq(this.checked?1:0).show(),$(".j").find("input").each(e=>{e.checked=!1})}),$("#cnn").on("click",function(){let o=$("p.j>:checked").val();if(null!==o){let n=$(`[data-v="${t.val()}"]`).parent(),i=$(".w>:checked").val(),a=200==i?"b":"span",l=n.find(".jegy").eq(-1).parent(),s=l[0];s.innerHTML+=` < ${a} tooltip = 'Milenne ha-val hozzáadott jegy&#xa;Súly: ${i}%' class='milenne jegy' > ${o}</${a}> `,_(n),e.close(),l.parent().addClass("open"),intoView(s)}})}$("a[href*=logout]").on("click",function(){deleteCookie("naplo"),deleteCookie("rme")}),ga("pageview");let A=$("#gdpr");if(A.is()&&Modal(A,{opacity:0,dismissible:!1,preventScrolling:!1,onCloseEnd:function(){addCookie("gdpr")}}).open(),$(".pwa").is()){let t;$(e).on("beforeinstallprompt",e=>{e.preventDefault(),t=e,$(".pwa").show().on("click",()=>{t.prompt(),ga("event",{ec:"installprompt",ea:"fired"}),t.userChoice.then(e=>{"accepted"===e.outcome?(addCookie("pwa",1),console.log("User accepted the A2HS prompt")):(addCookie("pwa",0),console.log("User dismissed the A2HS prompt")),t=null,ga("event",{ec:"installprompt",ea:e.outcome,el:e.platform})})})})}}$(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"/"}).then(function(e){console.log("Service Worker Registered"),e.sync.register("bg")}),t?D():T&&($preloadOnMousedown=!0,t=g(location.href),s[t]={body:document.body,title:document.title,scrollY:pageYOffset},w(),O.init(),$(e).on("popstate",function(){var e=g(location.href);e!=t&&(e in s?(s[t].scrollY=pageYOffset,t=e,b(s[e].title,s[e].body,e,s[e].scrollY)):location.href=location.href)}))}),$(e).on("appinstalled",()=>{addCookie("pwa")})}(this);