function Modal(e,t){let o={open:function(){if(o.isOpen)return;o.isOpen=!0,Modal._modalsOpen++,o._nthModalOpened=Modal._modalsOpen;let e=1e3+2*Modal._modalsOpen;if(o.$overlay.css({zIndex:e}),o.$el.css({zIndex:e+1}),o.options.preventScrolling&&$("body").addClass("no-scroll"),o.$overlay.show().css({opacity:o.options.opacity}),o.el.insertAdjacentElement("afterend",o.$overlay[0]),o.$el.addClass("open"),o.options.dismissible){var t=$(document);t.on("keydown",function(e){27===e.keyCode&&o.options.dismissible&&o.close()}),t.on("focus",function(e){o.el.contains(e.target)||o._nthModalOpened!==Modal._modalsOpen||o.el.focus()})}o.el.focus()},close:function(){if(o.isOpen){if(o.isOpen=!1,Modal._modalsOpen--,o._nthModalOpened=0,o.$overlay.css({opacity:0}),o.$el.removeClass("open"),$("body").removeClass("no-scroll"),o.options.dismissible){var e=$(document);e.off("keydown",o._handleKeydownBound),e.off("focus",o._handleFocusBound,!0)}setTimeout(function(){o.$overlay.remove(),o.options.onCloseEnd&&o.options.onCloseEnd()},250)}}};return o.$el=$(e),o.el=o.$el[0],o.options=$.fn.extend({opacity:.5,onCloseEnd:null,preventScrolling:!0,dismissible:!0},t),o.isOpen=!1,o.$overlay=$(`<div ${0==o.options.opacity?"":'class="overlay"'}></div>`),o._nthModalOpened=0,Modal._count++,o.$overlay.on("click",function(){o.options.dismissible&&o.close()}),o.$el.on("click",function(e){$(e.target).closest(".modal-close").is()&&o.close()}),o}function ga(e,t={}){t={...t,t:e,cd1:"serviceWorker"in navigator?navigator.serviceWorker.controller?"controlled":"supported":"unsupported",cd2:!0===navigator.standalone||matchMedia("(display-mode: standalone)").matches?1:0,sr:`${innerWidth}x${innerHeight}`,ul:navigator.language.toLowerCase(),dl:location.href,dt:document.title};let o="";for(let e in t)o+=`${e}=${encodeURIComponent(t[e])}&`;ajax(`./collect?${o}`,()=>{})}Modal._modalsOpen=0,"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"/"}).then(function(e){console.log("Service Worker Registered"),e.sync.register("bg")}),function(e){var t,o,n,i=navigator.userAgent,l={},a=!1,s=!1,c=!1,r=!1,d=!1,f=!1,u=!1;function p(e){return e.split("#")[0]}function m(e){let t=$(e).closest("a");return t.is()?t:$(e)}function g(e){let o=e[0];var n=location.protocol+"//"+location.host;return!(!e.is("a")||o.target||e.hasAttr("download")||0!=o.href.indexOf(n+"/")||0!=/login|addUser/.test(o)||p(o.href)==t||$(e).closest("[data-no-instant]").is())}function v(e,o,n){document.documentElement.replaceChild(o,document.body),t=p(n),url=n.split("#"),history.pushState(null,null,url[0]),document.title=e+String.fromCharCode(160),location.hash=url[1]?`#${url[1]}`:"",b(),w.done()}function y(e){if(n<+new Date-500){var t=m(e.target);t.is()&&g(t)&&C(t[0].href)}}function k(e){var t=m(e.target);t.is()&&g(t)&&(e.which>1||e.metaKey||e.ctrlKey||(e.preventDefault(),M(t[0].href)))}function b(){$("body").on("mousedown",y).on("click",k),q()}function C(e){e||(e=o),f||e==s||u||(f=!0,u=!1,s=e,d=!1,r=!1,e=addParam(e,"just_html"),(a=ajax(e,function(e){var t=document.implementation.createHTMLDocument("");t.documentElement.innerHTML=e.replace(/<noscript[\s\S]+<\/noscript>/gi,""),c=t.title,d=t.body;var o=p(s);l[o]={body:d,title:c,scrollY:o in l?l[o].scrollY:0},u&&(u=!1,M(s))},a)).onerror=function(){u=!1,w.done()})}function M(e){f?u?location.href=e:r?location.href=s:d?(l[t].scrollY=pageYOffset,f=!1,u=!1,v(c,d,s)):(w.start(0,!0),u=!0):(C(e),w.start(0,!0),u=!0)}var w=function(){var e,t,o,n;function i(){e=$("#ic"),t=$("#ic-bar")}function l(){o<98&&(o+=1+2*Math.random(),n=setTimeout(l,500)),a()}function a(){i(),t.css({transform:"translate("+o+"%)"})}return{start:function(t,s){i(),o=t,e.css({opacity:1}),a(),s&&requestAnimationFrame(function(){o=10,a()}),clearTimeout(n),n=setTimeout(l,500)},done:function(){clearTimeout(n),requestAnimationFrame(()=>{o=100,a(),e.css({opacity:0})})}}}(),x="pushState"in history&&(!i.match("Android")||i.match("Chrome/"));function O(){if(/\/orarend/.test(location.href)){$(".collection-item").css("height","unset");for(let e=$("ul"),t=0;e.is();e=$("ul.collection li:nth-child("+ ++t+")")){if(0==t)continue;let o=0;e.each(e=>{o=Math.max($(e).height(),o)}),e.css("height",o+"px")}$("#tt")[0].scrollTo(innerWidth*$("b.active").index(),0)}}const j=e=>Math.round(100*e)/100;function T(e){let t=[],o=0;e.find(".jegy").each(e=>{let n=(e=$(e)).is("b")?1:e.attr("tooltip").indexOf("100%")<0?.25:.5,i=e.html();i.indexOf("/")<0?t.push(n*i):t.push(...i.split("/").map(e=>e*(n/2))),o+=n});let n=j(t.reduce((e,t)=>Number(e)+Number(t))/o),i=e.find("nd");diff=j(n-i.eq(-2).html()),i.eq(-1).html(diff).removeClass("red gr").addClass(diff<0?"red":"gr"),i.eq(-3).html(n),h=$(`[value="${i.eq(0).attr("data-v")}"]`),h.html([h.html().split(" - ").shift(),n].join(" - "))}function _(e,t,o,n,i){e.find("span").html("-"),$(o).each(function(o){let n=t.attr(`data-${o}`);n&&e.find(`[data-${o}]`).html(n)});for(let t in n)e.find(`[data-${t}]`).html(n[t]);i.open()}let S=!1,Y=!1;function A(){Y&&S||(scrolling=!0)}function q(){const t=$("#menu"),o=$(location.hash),i=location.href;if(o.is()&&(intoView(o[0]),$(o).find(".collapsible-body").addClass("open")),scrolling=!1,t.is()){let e=$("body"),o=!1,i=!1,r={x:0,y:0},d={x:0,y:0},f=0,u=!1,h=70,p=307,v=t.next();function l(e){t.css({transform:`translateX(${e})`})}function a(){v.show().css({opacity:""}),e.addClass("no-scroll"),l(0),t.addClass("open"),Y=!0}function s(){v.hide(),e.removeClass("no-scroll"),l("-110%"),t.removeClass("open"),Y=!1}function c(){i||($("#rle").css({top:""}),$("body").removeClass("spin"))}v.on("click",s),$("#mo").on("click",()=>{a()}),e.on("touchstart",function(e){if(1==e.touches.length){u=!1,S=!1,r.x=e.touches[0].pageX,r.y=e.touches[0].pageY,n=+new Date;var t=m(e.target);t.is()&&g(t)&&(t.off("mousedown",y),C(t[0].href))}}).on("touchmove",function(t){if(v.hide(),(S||Y)&&v.show(),!scrolling&&void 0!==t.touches&&!Modal._modalsOpen){var n=t.touches[0].clientX-r.x,a=f=n;if((Math.abs(a)<p||r.x<50)&&Math.abs(n)>20&&(S=!0,!Y&&n>0||Y&&n<0)){n<=0&&(a=n+p,S=!1);let e=a-p;v.css({opacity:(280+e)/280*.2}),l(Math.min(e,0)+"px"),u=!0}if(o=0===document.scrollingElement.scrollTop&&!(Y||S),e.toggleClass("no-scroll",o),o&&!i){const e=t.touches[0].pageY-r.y;$("#rle").css({top:Math.min(e,120)+"px"})}else c()}}).on("touchcancel",function(){u=!1,S=!1,scrolling=!1}).on("touchend",function(e){if(u&&(S&&Math.abs(f)>h?a():s()),u=!1,d.x=e.changedTouches[0].pageX,d.y=e.changedTouches[0].pageY,o){var t=Math.abs(r.y-d.y),n=Math.abs(r.x-d.x);!i&&r.y<d.y&&(n<=100&&t>=90||n/t<=.3&&t>=60)?(c(),$("body").addClass("spin"),i=!0,M(addParam(location.href,"fr"))):c(),o=!1}scrolling=!1})}if(/\/orarend/.test(i)){O();let e=$(`[data-day="${(new Date).toISOString().split("T")[0]}"]`);e.is()&&(e.addClass("activeDay"),$("#tt")[0].scrollTo(e.index()*innerWidth,0));var r=Modal(u=$("#modal"));$(".lesson").on("click",function(){let e=$(this),t=e.find("b");_(u,e,["lecke","time","theme"],{nth:e.parent().attr("data-nth"),tr:t.html(),teacher:e.find("i").html(),room:e.find(".secondary-content").html()},r),u.find(".modal-content>span").html(t.is(".em")?"Elmarad!":"")}),$(".btns b").on("click",function(){let e=$(this);$("#tt")[0].scrollTo(innerWidth*e.index(),0),e.siblings().removeClass("active")});let t=null;$("#tt").on("scroll",()=>{clearTimeout(t),t=setTimeout(function(){$(".btns b").removeClass("active").eq(Math.round($("#tt")[0].scrollLeft/innerWidth)).addClass("active")},250),A()}),$("#printBtn").on("click",function(){print()}),o.is(".lesson")&&o[0].click()}if(/\/faliujsag/.test(i)&&$("#fj li").on("click",function(e){$(e.target).is("a")||$(this).find(".secondary-content")[0].click()}),/\/lecke/.test(i)){if(!/Mobi|Android/i.test(navigator.userAgent))if("function"==typeof DatePicker)new DatePicker;else{var d=document.createElement("script");d.type="text/javascript",d.src="assets/picker.js",d.onload=function(){new DatePicker},$("body").append(d)}$("[name=t]").on("change",function(){"date"==this.value?($("#hi").show(),$("#date").attr("required",!0)):($("#hi").hide(),$("#date")[0].removeAttribute("required"))});r=Modal(u=$("#modal"));$(".collection-item").on("click",function(){let e=$(this),t=u.find("a").hide();e.hasAttr("data-del")&&t.show().attr("href","./lecke/torles?did="+e.attr("data-del")),r.open(),_(u,e,["lecke","sender","cdate"],{deadline:e.find("a").html(),tr:e.html().split("<")[0]},r)});var f=Modal("#addModal");$(".fab").on("click",function(){f.open()}),$("form").on("submit",function(){let e=$("#txt")[0],t=e.innerText.trim();return t?($("#hw").val(t),!0):(e.focus(),!1)})}if($(".collapsible .collapsible-header").on("click",function(){$(this).next().toggleClass("open")}),/\/hianyzasok/.test(i)){var u;r=Modal(u=$("#modal"));$("li p").on("click",function(){let e=$(this),t=e.parent().prev();_(u,e,["ct","jst","t","s"],{d:t.find("span").html(),ty:t.attr("data-ty")},r),$("#link").attr("href",`orarend?week=-${e.attr("data-l")}`)})}if(/\/jegyek/.test(i)){o.closest("nr").addClass("open");let e=Modal("#addModal");$(".fab").on("click",e.open);let t=$("#tr");$("#tort").on("change",function(){$(".j").hide().eq(this.checked?1:0).show(),$(".j").find("input").each(e=>{e.checked=!1})}),$("#cnn").on("click",function(){let o=$("p.j>:checked").val();if(null!==o){let n=$(`[data-v="${t.val()}"]`).parent(),i=$(".w>:checked").val(),l=200==i?"b":"span",a=n.find(".jegy").eq(-1).parent(),s=a[0];s.innerHTML+=` < ${l} tooltip = 'Milenne ha-val hozzáadott jegy&#xa;Súly: ${i}%' class='milenne jegy' > ${o}</${l}> `,T(n),e.close(),a.parent().addClass("open"),intoView(s)}})}$("a[href*=logout]").on("click",function(){deleteCookie("naplo"),deleteCookie("rme")}),ga("pageview");let h=$("#gdpr");if(h.is()&&Modal(h,{opacity:0,dismissible:!1,preventScrolling:!1,onCloseEnd:function(){addCookie("gdpr")}}).open(),$(".pwa").is()){let t;$(e).on("beforeinstallprompt",e=>{e.preventDefault(),t=e,$(".pwa").show().on("click",()=>{t.prompt(),ga("event",{ec:"installprompt",ea:"fired"}),t.userChoice.then(e=>{"accepted"===e.outcome?(addCookie("pwa",1),console.log("User accepted the A2HS prompt")):(addCookie("pwa",0),console.log("User dismissed the A2HS prompt")),t=null,ga("event",{ec:"installprompt",ea:e.outcome,el:e.platform})})})})}}e.scrolling=!1,$(()=>{t?q():x&&($preloadOnMousedown=!0,t=p(location.href),l[t]={body:document.body,title:document.title,scrollY:pageYOffset},b(),$(e).on("popstate",function(){var e=p(location.href);e!=t&&(e in l?(l[t].scrollY=pageYOffset,t=e,v(l[e].title,l[e].body,e,l[e].scrollY)):location.href=location.href)}))}),$(e).on("resize",O).on("scroll",A).on("mousemove","[tooltip]",function(){$(this).toggleClass("bot",$(this).offset().top-scrollY-getComputedStyle(this,":after").getPropertyValue("height").replace("px","")-76<=0)}).on("dblclick",".milenne",function(){let e=$(this),t=e.closest("nr");e.remove(),T(t)}).on("error",function(e){ga("exception",{exd:e.error&&e.error.stack||`${e.message}; ${e.lineno}: ${e.colno} `})}).on("click","nr nd:first-child",function(e){$(this).closest("nr").toggleClass("open")}).on("appinstalled",()=>{addCookie("pwa")})}(this);